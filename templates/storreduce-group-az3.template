{
    "Conditions": {
        "GovCloudCondition": {
            "Fn::Equals": [
                {
                    "Ref": "AWS::Region"
                },
                "us-gov-west-1"
            ]
        },
        "NumInstancesLessThanOrEqualTo10": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        10
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo9"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo11": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        11
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo10"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo12": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        12
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo11"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo13": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        13
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo12"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo14": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        14
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo13"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo15": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        15
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo14"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo16": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        16
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo15"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo17": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        17
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo16"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo18": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        18
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo17"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo19": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        19
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo18"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo20": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        20
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo19"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo21": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        21
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo20"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo22": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        22
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo21"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo23": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        23
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo22"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo24": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        24
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo23"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo25": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        25
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo24"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo26": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        26
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo25"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo27": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        27
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo26"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo28": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        28
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo27"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo29": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        29
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo28"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo30": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        30
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo29"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo31": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        31
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo30"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo4": {
            "Fn::Equals": [
                {
                    "Ref": "NumSRRHosts"
                },
                4
            ]
        },
        "NumInstancesLessThanOrEqualTo5": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        5
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo4"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo6": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        6
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo5"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo7": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        7
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo6"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo8": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        8
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo7"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo9": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        9
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo8"
                }
            ]
        }
    },
    "Mappings": {
        "AWSAMIRegion": {
            "ap-northeast-1": {
                "AMI": "ami-07583061",
                "MonitorAMI": "ami-203df15f"
            },
            "ap-northeast-2": {
                "AMI": "ami-f12c8f9f",
                "MonitorAMI": "ami-5d832933"
            },
            "ap-south-1": {
                "AMI": "ami-9d84d4f2",
                "MonitorAMI": "ami-70ac841f"
            },
            "ap-southeast-1": {
                "AMI": "ami-d4c88da8",
                "MonitorAMI": "ami-92ada9ee"
            },
            "ap-southeast-2": {
                "AMI": "ami-a35ca5c1",
                "MonitorAMI": "ami-00b76862"
            },
            "ca-central-1": {
                "AMI": "ami-1dde5a79",
                "MonitorAMI": "ami-9678fbf2"
            },
            "eu-central-1": {
                "AMI": "ami-613ca70e",
                "MonitorAMI": "ami-a88cbc43"
            },
            "eu-west-1": {
                "AMI": "ami-fc4d2f85",
                "MonitorAMI": "ami-a3272ada"
            },
            "eu-west-2": {
                "AMI": "ami-86d1cbe2",
                "MonitorAMI": "ami-c5bd53a2"
            },
            "eu-west-3": {
                "AMI": "ami-55b40228",
                "MonitorAMI": "ami-fa2b9a87"
            },
            "sa-east-1": {
                "AMI": "ami-472d622b",
                "MonitorAMI": "ami-a65f04ca"
            },
            "us-east-1": {
                "AMI": "ami-2084be5a",
                "MonitorAMI": "ami-d70640a8"
            },
            "us-east-2": {
                "AMI": "ami-dd0431b8",
                "MonitorAMI": "ami-0e1e206b"
            },
            "us-west-1": {
                "AMI": "ami-57f3ff37",
                "MonitorAMI": "ami-c8fe1aab"
            },
            "us-west-2": {
                "AMI": "ami-aee2a6d6",
                "MonitorAMI": "ami-7e571406"
            }
        }
    },
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Label": {
                        "default": "StorReduce Configuration"
                    },
                    "Parameters": [
                        "KeyPairName",
                        "StorReducePassword",
                        "ShardsNum",
                        "ReplicaShardsNum",
                        "InstanceType",
                        "MonitorInstanceType",
                        "BucketName",
                        "NumSRRHosts",
                        "StorReduceLicense"
                    ]
                },
                {
                    "Label": {
                        "default": "VPC Network Configuration"
                    },
                    "Parameters": [
                        "NumberOfAZs",
                        "VpcId",
                        "VPCCIDR",
                        "RemoteAccessCIDR",
                        "PrivateSubnetsToSpan",
                        "PublicSubnetsToSpan"
                    ]
                },
                {
                    "Label": {
                        "default": "AWS Quick Start Configuration"
                    },
                    "Parameters": [
                        "QSS3BucketName",
                        "QSS3KeyPrefix"
                    ]
                }
            ],
            "ParameterLabels": {
                "BastionAMIOS": {
                    "default": "Bastion AMI Operating System"
                },
                "BastionInstanceType": {
                    "default": "Bastion Instance Type"
                },
                "BucketName": {
                    "default": "Bucket Name"
                },
                "InstanceType": {
                    "default": "Instance Type"
                },
                "KeyPairName": {
                    "default": "Key Pair Name"
                },
                "MonitorInstanceType": {
                    "default": "Monitor Instance Type"
                },
                "NumBastionHosts": {
                    "default": "Number of Bastion Hosts"
                },
                "NumSRRHosts": {
                    "default": "Number of StorReduce servers"
                },
                "NumberOfAZs": {
                    "default": "Number of Availability Zones"
                },
                "PrivateSubnetsToSpan": {
                    "default": "VPC Private Subnets"
                },
                "PublicSubnetsToSpan": {
                    "default": "VPC Public Subnets"
                },
                "QSS3BucketName": {
                    "default": "Quick Start S3 Bucket Name"
                },
                "QSS3KeyPrefix": {
                    "default": "Quick Start S3 Key Prefix"
                },
                "RemoteAccessCIDR": {
                    "default": "External Allowed Access CIDR"
                },
                "ReplicaShardsNum": {
                    "default": "Number of Replica Shards"
                },
                "ShardsNum": {
                    "default": "Number of Shards"
                },
                "StorReduceLicense": {
                    "default": "StorReduce license"
                },
                "StorReducePassword": {
                    "default": "StorReduce Password"
                },
                "VPCCIDR": {
                    "default": "VPC CIDR"
                },
                "VpcId": {
                    "default": "VPC ID"
                }
            }
        }
    },
    "Outputs": {
        "NetworkLoadBalancerDNSName": {
            "Description": "Network Load Balancer DNS Name",
            "Value": {
                "Fn::GetAtt": [
                    "NetworkLoadBalancer",
                    "DNSName"
                ]
            }
        },
        "NetworkLoadBalancerID": {
            "Description": "Network Load Balancer ID",
            "Value": {
                "Ref": "NetworkLoadBalancer"
            }
        },
        "StorReduceAdminUIAddress": {
            "Description": "Address for StorReduce Administration",
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        "http://",
                        {
                            "Fn::GetAtt": [
                                "NetworkLoadBalancer",
                                "DNSName"
                            ]
                        },
                        ":8080"
                    ]
                ]
            }
        },
        "StorReduceHTTPEndpoint": {
            "Description": "StorReduce S3 Endpoint over HTTP",
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        "http://",
                        {
                            "Fn::GetAtt": [
                                "NetworkLoadBalancer",
                                "DNSName"
                            ]
                        },
                        ":80"
                    ]
                ]
            }
        },
        "StorReduceHTTPSEndpoint": {
            "Description": "StorReduce S3 Endpoint over HTTPS",
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        "http://",
                        {
                            "Fn::GetAtt": [
                                "NetworkLoadBalancer",
                                "DNSName"
                            ]
                        },
                        ":443"
                    ]
                ]
            }
        },
        "StorReduceMonitorElasticAddress": {
            "Description": "Address for Elasticsearch on StorReduce Monitor",
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        "http://",
                        {
                            "Fn::GetAtt": [
                                "NetworkLoadBalancer",
                                "DNSName"
                            ]
                        },
                        ":9200"
                    ]
                ]
            }
        },
        "StorReduceMonitorGrafanaDashboardAddress": {
            "Description": "Address for Grafana Dashboard on StorReduce Monitor",
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        "http://",
                        {
                            "Fn::GetAtt": [
                                "NetworkLoadBalancer",
                                "DNSName"
                            ]
                        },
                        ":3000"
                    ]
                ]
            }
        },
        "StorReduceMonitorKibanaDashboardAddress": {
            "Description": "Address for Kibana Dashboard on StorReduce Monitor",
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        "http://",
                        {
                            "Fn::GetAtt": [
                                "NetworkLoadBalancer",
                                "DNSName"
                            ]
                        },
                        ":5601"
                    ]
                ]
            }
        }
    },
    "Parameters": {
        "BucketName": {
            "ConstraintDescription": "must be a valid S3 bucket name.",
            "Description": "The bucket to which StorReduce will store data. This should be a unique name, not an existing bucket as a new bucket will be created",
            "Type": "String"
        },
        "InstanceType": {
            "AllowedValues": [
                "c3.large",
                "c3.xlarge",
                "c3.2xlarge",
                "c3.4xlarge",
                "c3.8xlarge",
                "c5d.large",
                "c5d.xlarge",
                "c5d.2xlarge",
                "c5d.4xlarge",
                "c5d.9xlarge",
                "c5d.18xlarge",
                "cr1.8xlarge",
                "f1.2xlarge",
                "f1.16xlarge",
                "g2.2xlarge",
                "g2.8xlarge",
                "i2.xlarge",
                "i2.2xlarge",
                "i2.4xlarge",
                "i2.8xlarge",
                "i3.large",
                "i3.xlarge",
                "i3.2xlarge",
                "i3.4xlarge",
                "i3.8xlarge",
                "i3.16xlarge",
                "i3.metal",
                "m3.medium",
                "m3.large",
                "m3.xlarge",
                "m3.2xlarge",
                "m5d.large",
                "m5d.xlarge",
                "m5d.2xlarge",
                "m5d.4xlarge",
                "m5d.12xlarge",
                "m5d.24xlarge",
                "r3.large",
                "r3.xlarge",
                "r3.2xlarge",
                "r3.4xlarge",
                "r3.8xlarge",
                "x1.16xlarge",
                "x1.32xlarge",
                "x1e.xlarge",
                "x1e.2xlarge",
                "x1e.4xlarge",
                "x1e.8xlarge",
                "x1e.16xlarge",
                "x1e.32xlarge"
            ],
            "ConstraintDescription": "must be a valid EC2 instance type.",
            "Default": "i3.4xlarge",
            "Description": "StorReduce EC2 instance type",
            "Type": "String"
        },
        "KeyPairName": {
            "ConstraintDescription": "must be the name of an existing EC2 KeyPair.",
            "Description": "Name of an existing EC2 KeyPair to enable SSH access to the instances",
            "Type": "AWS::EC2::KeyPair::KeyName"
        },
        "MonitorInstanceType": {
            "AllowedValues": [
                "c3.large",
                "c3.xlarge",
                "c3.2xlarge",
                "c3.4xlarge",
                "c3.8xlarge",
                "c5d.large",
                "c5d.xlarge",
                "c5d.2xlarge",
                "c5d.4xlarge",
                "c5d.9xlarge",
                "c5d.18xlarge",
                "cr1.8xlarge",
                "f1.2xlarge",
                "f1.16xlarge",
                "g2.2xlarge",
                "g2.8xlarge",
                "i2.xlarge",
                "i2.2xlarge",
                "i2.4xlarge",
                "i2.8xlarge",
                "i3.large",
                "i3.xlarge",
                "i3.2xlarge",
                "i3.4xlarge",
                "i3.8xlarge",
                "i3.16xlarge",
                "i3.metal",
                "m3.medium",
                "m3.large",
                "m3.xlarge",
                "m3.2xlarge",
                "m5d.large",
                "m5d.xlarge",
                "m5d.2xlarge",
                "m5d.4xlarge",
                "m5d.12xlarge",
                "m5d.24xlarge",
                "r3.large",
                "r3.xlarge",
                "r3.2xlarge",
                "r3.4xlarge",
                "r3.8xlarge",
                "x1.16xlarge",
                "x1.32xlarge",
                "x1e.xlarge",
                "x1e.2xlarge",
                "x1e.4xlarge",
                "x1e.8xlarge",
                "x1e.16xlarge",
                "x1e.32xlarge"
            ],
            "ConstraintDescription": "must be a valid EC2 instance type.",
            "Default": "i3.large",
            "Description": "EC2 instance type",
            "Type": "String"
        },
        "NumSRRHosts": {
            "AllowedValues": [
                3,
                5,
                7,
                9,
                11,
                13,
                15,
                17,
                19,
                21,
                23,
                25,
                27,
                29,
                31
            ],
            "ConstraintDescription": "Number of StorReduce hosts must be an odd number between 3 and 31.",
            "Description": "The number of StorReduce hosts to configure",
            "MaxValue": 31,
            "MinValue": 3,
            "Type": "Number"
        },
        "PrivateSubnetsToSpan": {
            "Description": "A list of VPC private subnets to span for StorReduce instances to reside. This number must equal the number of availability zones specified",
            "Type": "List<AWS::EC2::Subnet::Id>"
        },
        "PublicSubnetsToSpan": {
            "Description": "A list of VPC public subnets to span for the StorReduce Load Balancer to cover",
            "Type": "List<AWS::EC2::Subnet::Id>"
        },
        "QSS3BucketName": {
            "AllowedPattern": "^[0-9a-zA-Z]+([0-9a-zA-Z\\-]*[0-9a-zA-Z])*$",
            "ConstraintDescription": "Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).",
            "Default": "aws-quickstart",
            "Description": "S3 bucket name for the Quick Start assets. Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-)",
            "Type": "String"
        },
        "QSS3KeyPrefix": {
            "AllowedPattern": "^[0-9a-zA-Z\\-/]*$",
            "ConstraintDescription": "Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).",
            "Default": "quickstart-storreduce/",
            "Description": "S3 key prefix for the Quick Start assets. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/)",
            "Type": "String"
        },
        "RemoteAccessCIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/x",
            "Description": "Allowed CIDR block for bastion, StorReduce Monitor and load balancer access",
            "Type": "String"
        },
        "ReplicaShardsNum": {
            "Description": "The number of replica shards to use for the StorReduce cluster. Replicas create redundancy for higher resiliency but use extra CPU and disk space",
            "MinValue": 0,
            "Type": "Number"
        },
        "ShardsNum": {
            "Description": "The number of shards to use for StorReduce. Set to 0 for automatic configuration (i.e. 8 * number of servers)",
            "MinValue": 0,
            "Type": "Number"
        },
        "StorReduceHostName": {
            "Description": "The hostname to be used to address StorReduce. Objects stored on StorReduce will be addressed http://hostname/bucket/key or http://bucket.hostname/key. StorReduce settings will automatically be configured to add the AWS internal DNS values of the instances within the VPC and the AWS default public DNS name of the load balancer. This field can be populated as a comma-separated list of other DNS names corresponding to aliases for the load balancer, or else left blank",
            "Type": "String"
        },
        "StorReduceLicense": {
            "ConstraintDescription": "must be a current and valid StorReduce license.",
            "Description": "A StorReduce license",
            "Type": "String"
        },
        "StorReducePassword": {
            "Description": "The password for the StorReduce admin root user. This password is used to configure the StorReduce admin web interface and admin account for Grafana on the StorReduce Monitor server. StorReduce Monitor access to Elasticsearch and Kibana are also secured using Basic Auth against the StorReduce user management system.",
            "NoEcho": true,
            "Type": "String"
        },
        "VPCCIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28",
            "Default": "10.0.0.0/16",
            "Description": "CIDR Block for the VPC",
            "Type": "String"
        },
        "VpcId": {
            "ConstraintDescription": "Your VPC-ID must be in the form vpc-xxxxxxxx where 'x' can be a number or a letter.",
            "Description": "VPC-ID of your existing Virtual Private Cloud (VPC) where you want to deploy a StorReduce cluster",
            "Type": "AWS::EC2::VPC::Id"
        }
    },
    "Resources": {
        "AllInternalAccessSecurityGroup": {
            "Properties": {
                "GroupDescription": "Enables StorReduce and SSH ports TCP access from within the VPC",
                "SecurityGroupIngress": [
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "22",
                        "IpProtocol": "tcp",
                        "ToPort": "22"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "80",
                        "IpProtocol": "tcp",
                        "ToPort": "80"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "443",
                        "IpProtocol": "tcp",
                        "ToPort": "443"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "8095",
                        "IpProtocol": "tcp",
                        "ToPort": "8099"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "2379",
                        "IpProtocol": "tcp",
                        "ToPort": "2380"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "8080",
                        "IpProtocol": "tcp",
                        "ToPort": "8080"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "5044",
                        "IpProtocol": "tcp",
                        "ToPort": "5044"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "9090",
                        "IpProtocol": "tcp",
                        "ToPort": "9090"
                    },
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "80",
                        "IpProtocol": "tcp",
                        "ToPort": "80"
                    },
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "443",
                        "IpProtocol": "tcp",
                        "ToPort": "443"
                    },
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "8080",
                        "IpProtocol": "tcp",
                        "ToPort": "8080"
                    }
                ],
                "VpcId": {
                    "Ref": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        },
        "Eth0": {
            "DependsOn": "AllInternalAccessSecurityGroup",
            "Properties": {
                "Description": "eth0",
                "GroupSet": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "MonitorSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Interface",
                        "Value": "eth0"
                    },
                    {
                        "Key": "Name",
                        "Value": "Interface 0"
                    }
                ]
            },
            "Type": "AWS::EC2::NetworkInterface"
        },
        "MonitorInstance": {
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": [
                "StorReduceInstance0",
                "StorReduceHostProfile"
            ],
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "monitor-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/monitor-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "'"
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/monitor-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/monitor-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "MonitorAMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "MonitorInstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "NetworkInterfaces": [
                    {
                        "DeviceIndex": "0",
                        "NetworkInterfaceId": {
                            "Ref": "Eth0"
                        }
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Monitor-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource MonitorInstance --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource MonitorInstance --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "MonitorSecurityGroup": {
            "Properties": {
                "GroupDescription": "Enables remote access to port 3000 and 5601 for StorReduce monitor",
                "SecurityGroupIngress": [
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "3000",
                        "IpProtocol": "tcp",
                        "ToPort": "3000"
                    },
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "5601",
                        "IpProtocol": "tcp",
                        "ToPort": "5601"
                    },
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "9200",
                        "IpProtocol": "tcp",
                        "ToPort": "9200"
                    }
                ],
                "VpcId": {
                    "Ref": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        },
        "NetworkLoadBalancer": {
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "Properties": {
                "Name": "NetworkLoadBalancer",
                "Scheme": "internet-facing",
                "Subnets": {
                    "Ref": "PublicSubnetsToSpan"
                },
                "Type": "network"
            },
            "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer"
        },
        "SrrBucket": {
            "DeletionPolicy": "Retain",
            "Properties": {
                "BucketName": {
                    "Ref": "BucketName"
                }
            },
            "Type": "AWS::S3::Bucket"
        },
        "StorReduceHostProfile": {
            "DependsOn": "StorReduceHostRole",
            "Properties": {
                "Path": "/",
                "Roles": [
                    {
                        "Ref": "StorReduceHostRole"
                    }
                ]
            },
            "Type": "AWS::IAM::InstanceProfile"
        },
        "StorReduceHostRole": {
            "DependsOn": "SrrBucket",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Action": [
                                "sts:AssumeRole"
                            ],
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "ec2.amazonaws.com"
                                ]
                            }
                        }
                    ],
                    "Version": "2012-10-17"
                },
                "Path": "/",
                "Policies": [
                    {
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Action": [
                                        "s3:GetObject"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": {
                                        "Fn::Sub": [
                                            "arn:${Partition}:s3:::${QSS3BucketName}/${QSS3KeyPrefix}*",
                                            {
                                                "Partition": {
                                                    "Fn::If": [
                                                        "GovCloudCondition",
                                                        "aws-us-gov",
                                                        "aws"
                                                    ]
                                                }
                                            }
                                        ]
                                    }
                                }
                            ],
                            "Version": "2012-10-17"
                        },
                        "PolicyName": "aws-quick-start-s3-policy"
                    },
                    {
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Action": [
                                        "s3:ListBucket",
                                        "s3:ListBucketMultipartUploads"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:s3:::",
                                                {
                                                    "Ref": "BucketName"
                                                }
                                            ]
                                        ]
                                    }
                                }
                            ],
                            "Version": "2012-10-17"
                        },
                        "PolicyName": "srr-quick-start-s3-policy-bucket"
                    },
                    {
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Action": [
                                        "s3:PutObject",
                                        "s3:GetObject",
                                        "s3:DeleteObject",
                                        "s3:ListMultipartUploadParts",
                                        "s3:AbortMultipartUpload"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:s3:::",
                                                {
                                                    "Ref": "BucketName"
                                                },
                                                "/*"
                                            ]
                                        ]
                                    }
                                }
                            ],
                            "Version": "2012-10-17"
                        },
                        "PolicyName": "srr-quick-start-s3-policy-objects"
                    },
                    {
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Action": [
                                        "elasticloadbalancing:Describe*",
                                        "elasticloadbalancing:DeregisterInstancesFromLoadBalancer",
                                        "elasticloadbalancing:RegisterInstancesWithLoadBalancer",
                                        "autoscaling:Describe*",
                                        "autoscaling:EnterStandby",
                                        "autoscaling:ExitStandby",
                                        "autoscaling:UpdateAutoScalingGroup",
                                        "autoscaling:SuspendProcesses",
                                        "autoscaling:ResumeProcesses"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": "*"
                                }
                            ],
                            "Version": "2012-10-17"
                        },
                        "PolicyName": "elb-join-policy"
                    }
                ]
            },
            "Type": "AWS::IAM::Role"
        },
        "StorReduceInstance0": {
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": [
                "SrrBucket",
                "StorReduceHostProfile",
                "AllInternalAccessSecurityGroup"
            ],
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "init-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/init-srr.sh \"",
                                            {
                                                "Ref": "BucketName"
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReduceLicense"
                                            },
                                            "' ",
                                            "'",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "'",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "' ",
                                            "'",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "StorReduceHostName"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "NetworkLoadBalancer",
                                                    "DNSName"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/init-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/init-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Base-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance0 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance0 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance1": {
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance0",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance1 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance1 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance10": {
            "Condition": "NumInstancesLessThanOrEqualTo11",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance9",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance10 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance10 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance11": {
            "Condition": "NumInstancesLessThanOrEqualTo12",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance10",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance11 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance11 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance12": {
            "Condition": "NumInstancesLessThanOrEqualTo13",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance11",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance12 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance12 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance13": {
            "Condition": "NumInstancesLessThanOrEqualTo14",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance12",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance13 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance13 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance14": {
            "Condition": "NumInstancesLessThanOrEqualTo15",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance13",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance14 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance14 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance15": {
            "Condition": "NumInstancesLessThanOrEqualTo16",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance14",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance15 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance15 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance16": {
            "Condition": "NumInstancesLessThanOrEqualTo17",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance15",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance16 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance16 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance17": {
            "Condition": "NumInstancesLessThanOrEqualTo18",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance16",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance17 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance17 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance18": {
            "Condition": "NumInstancesLessThanOrEqualTo19",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance17",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance18 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance18 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance19": {
            "Condition": "NumInstancesLessThanOrEqualTo20",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance18",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance19 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance19 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance2": {
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "MonitorInstance",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance2 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance2 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance20": {
            "Condition": "NumInstancesLessThanOrEqualTo21",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance19",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance20 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance20 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance21": {
            "Condition": "NumInstancesLessThanOrEqualTo22",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance20",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance21 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance21 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance22": {
            "Condition": "NumInstancesLessThanOrEqualTo23",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance21",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance22 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance22 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance23": {
            "Condition": "NumInstancesLessThanOrEqualTo24",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance22",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance23 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance23 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance24": {
            "Condition": "NumInstancesLessThanOrEqualTo25",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance23",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance24 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance24 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance25": {
            "Condition": "NumInstancesLessThanOrEqualTo26",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance24",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance25 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance25 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance26": {
            "Condition": "NumInstancesLessThanOrEqualTo27",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance25",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance26 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance26 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance27": {
            "Condition": "NumInstancesLessThanOrEqualTo28",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance26",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance27 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance27 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance28": {
            "Condition": "NumInstancesLessThanOrEqualTo29",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance27",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance28 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance28 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance29": {
            "Condition": "NumInstancesLessThanOrEqualTo30",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance28",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance29 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance29 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance3": {
            "Condition": "NumInstancesLessThanOrEqualTo4",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance2",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance3 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance3 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance30": {
            "Condition": "NumInstancesLessThanOrEqualTo31",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance29",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance30 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance30 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance4": {
            "Condition": "NumInstancesLessThanOrEqualTo5",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance3",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance4 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance4 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance5": {
            "Condition": "NumInstancesLessThanOrEqualTo6",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance4",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance5 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance5 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance6": {
            "Condition": "NumInstancesLessThanOrEqualTo7",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance5",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance6 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance6 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance7": {
            "Condition": "NumInstancesLessThanOrEqualTo8",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance6",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance7 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance7 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance8": {
            "Condition": "NumInstancesLessThanOrEqualTo9",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance7",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance8 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance8 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance9": {
            "Condition": "NumInstancesLessThanOrEqualTo10",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance8",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "StorReduceWebSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "StorReduce-QS-Host"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance9 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance9 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceNLBPort3000Listener": {
            "Properties": {
                "DefaultActions": [
                    {
                        "TargetGroupArn": {
                            "Ref": "StorReduceNLBTargetsPort3000"
                        },
                        "Type": "forward"
                    }
                ],
                "LoadBalancerArn": {
                    "Ref": "NetworkLoadBalancer"
                },
                "Port": "3000",
                "Protocol": "TCP"
            },
            "Type": "AWS::ElasticLoadBalancingV2::Listener"
        },
        "StorReduceNLBPort443Listener": {
            "Properties": {
                "DefaultActions": [
                    {
                        "TargetGroupArn": {
                            "Ref": "StorReduceNLBTargetsPort443"
                        },
                        "Type": "forward"
                    }
                ],
                "LoadBalancerArn": {
                    "Ref": "NetworkLoadBalancer"
                },
                "Port": "443",
                "Protocol": "TCP"
            },
            "Type": "AWS::ElasticLoadBalancingV2::Listener"
        },
        "StorReduceNLBPort5601Listener": {
            "Properties": {
                "DefaultActions": [
                    {
                        "TargetGroupArn": {
                            "Ref": "StorReduceNLBTargetsPort5601"
                        },
                        "Type": "forward"
                    }
                ],
                "LoadBalancerArn": {
                    "Ref": "NetworkLoadBalancer"
                },
                "Port": "5601",
                "Protocol": "TCP"
            },
            "Type": "AWS::ElasticLoadBalancingV2::Listener"
        },
        "StorReduceNLBPort8080Listener": {
            "Properties": {
                "DefaultActions": [
                    {
                        "TargetGroupArn": {
                            "Ref": "StorReduceNLBTargetsPort8080"
                        },
                        "Type": "forward"
                    }
                ],
                "LoadBalancerArn": {
                    "Ref": "NetworkLoadBalancer"
                },
                "Port": "8080",
                "Protocol": "TCP"
            },
            "Type": "AWS::ElasticLoadBalancingV2::Listener"
        },
        "StorReduceNLBPort80Listener": {
            "Properties": {
                "DefaultActions": [
                    {
                        "TargetGroupArn": {
                            "Ref": "StorReduceNLBTargetsPort80"
                        },
                        "Type": "forward"
                    }
                ],
                "LoadBalancerArn": {
                    "Ref": "NetworkLoadBalancer"
                },
                "Port": "80",
                "Protocol": "TCP"
            },
            "Type": "AWS::ElasticLoadBalancingV2::Listener"
        },
        "StorReduceNLBPort9200Listener": {
            "Properties": {
                "DefaultActions": [
                    {
                        "TargetGroupArn": {
                            "Ref": "StorReduceNLBTargetsPort9200"
                        },
                        "Type": "forward"
                    }
                ],
                "LoadBalancerArn": {
                    "Ref": "NetworkLoadBalancer"
                },
                "Port": "9200",
                "Protocol": "TCP"
            },
            "Type": "AWS::ElasticLoadBalancingV2::Listener"
        },
        "StorReduceNLBTargetsPort3000": {
            "Properties": {
                "Name": "StorReduceNLBTargetsPort3000",
                "Port": 3000,
                "Protocol": "TCP",
                "Targets": [
                    {
                        "Id": {
                            "Ref": "MonitorInstance"
                        },
                        "Port": 3000
                    }
                ],
                "VpcId": {
                    "Ref": "VpcId"
                }
            },
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup"
        },
        "StorReduceNLBTargetsPort443": {
            "Properties": {
                "Name": "StorReduceNLBTargetsPort443",
                "Port": 443,
                "Protocol": "TCP",
                "Targets": [
                    {
                        "Id": {
                            "Ref": "StorReduceInstance0"
                        },
                        "Port": 443
                    },
                    {
                        "Id": {
                            "Ref": "StorReduceInstance1"
                        },
                        "Port": 443
                    },
                    {
                        "Id": {
                            "Ref": "StorReduceInstance2"
                        },
                        "Port": 443
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo4",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance3"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo5",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance4"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo6",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance5"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo7",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance6"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo8",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance7"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo9",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance8"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo10",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance9"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo11",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance10"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo12",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance11"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo13",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance12"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo14",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance13"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo15",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance14"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo16",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance15"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo17",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance16"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo18",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance17"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo19",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance18"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo20",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance19"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo21",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance20"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo22",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance21"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo23",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance22"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo24",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance23"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo25",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance24"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo26",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance25"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo27",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance26"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo28",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance27"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo29",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance28"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo30",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance29"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo31",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance30"
                                },
                                "Port": 443
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    }
                ],
                "VpcId": {
                    "Ref": "VpcId"
                }
            },
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup"
        },
        "StorReduceNLBTargetsPort5601": {
            "Properties": {
                "Name": "StorReduceNLBTargetsPort5601",
                "Port": 5601,
                "Protocol": "TCP",
                "Targets": [
                    {
                        "Id": {
                            "Ref": "MonitorInstance"
                        },
                        "Port": 5601
                    }
                ],
                "VpcId": {
                    "Ref": "VpcId"
                }
            },
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup"
        },
        "StorReduceNLBTargetsPort80": {
            "Properties": {
                "Name": "StorReduceNLBTargetsPort80",
                "Port": 80,
                "Protocol": "TCP",
                "Targets": [
                    {
                        "Id": {
                            "Ref": "StorReduceInstance0"
                        },
                        "Port": 80
                    },
                    {
                        "Id": {
                            "Ref": "StorReduceInstance1"
                        },
                        "Port": 80
                    },
                    {
                        "Id": {
                            "Ref": "StorReduceInstance2"
                        },
                        "Port": 80
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo4",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance3"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo5",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance4"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo6",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance5"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo7",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance6"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo8",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance7"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo9",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance8"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo10",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance9"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo11",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance10"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo12",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance11"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo13",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance12"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo14",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance13"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo15",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance14"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo16",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance15"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo17",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance16"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo18",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance17"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo19",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance18"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo20",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance19"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo21",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance20"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo22",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance21"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo23",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance22"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo24",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance23"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo25",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance24"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo26",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance25"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo27",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance26"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo28",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance27"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo29",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance28"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo30",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance29"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo31",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance30"
                                },
                                "Port": 80
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    }
                ],
                "VpcId": {
                    "Ref": "VpcId"
                }
            },
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup"
        },
        "StorReduceNLBTargetsPort8080": {
            "Properties": {
                "Name": "StorReduceNLBTargetsPort8080",
                "Port": 8080,
                "Protocol": "TCP",
                "Targets": [
                    {
                        "Id": {
                            "Ref": "StorReduceInstance0"
                        },
                        "Port": 8080
                    },
                    {
                        "Id": {
                            "Ref": "StorReduceInstance1"
                        },
                        "Port": 8080
                    },
                    {
                        "Id": {
                            "Ref": "StorReduceInstance2"
                        },
                        "Port": 8080
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo4",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance3"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo5",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance4"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo6",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance5"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo7",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance6"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo8",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance7"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo9",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance8"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo10",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance9"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo11",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance10"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo12",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance11"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo13",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance12"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo14",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance13"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo15",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance14"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo16",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance15"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo17",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance16"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo18",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance17"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo19",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance18"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo20",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance19"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo21",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance20"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo22",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance21"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo23",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance22"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo24",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance23"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo25",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance24"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo26",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance25"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo27",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance26"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo28",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance27"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo29",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance28"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo30",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance29"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    },
                    {
                        "Fn::If": [
                            "NumInstancesLessThanOrEqualTo31",
                            {
                                "Id": {
                                    "Ref": "StorReduceInstance30"
                                },
                                "Port": 8080
                            },
                            {
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    }
                ],
                "VpcId": {
                    "Ref": "VpcId"
                }
            },
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup"
        },
        "StorReduceNLBTargetsPort9200": {
            "Properties": {
                "Name": "StorReduceNLBTargetsPort9200",
                "Port": 9200,
                "Protocol": "TCP",
                "Targets": [
                    {
                        "Id": {
                            "Ref": "MonitorInstance"
                        },
                        "Port": 9200
                    }
                ],
                "VpcId": {
                    "Ref": "VpcId"
                }
            },
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup"
        },
        "StorReduceWebSecurityGroup": {
            "Properties": {
                "GroupDescription": "Enables remote access to port 80 and 443 for the StorReduce load balancer",
                "SecurityGroupIngress": [
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "80",
                        "IpProtocol": "tcp",
                        "ToPort": "80"
                    },
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "443",
                        "IpProtocol": "tcp",
                        "ToPort": "443"
                    },
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "8080",
                        "IpProtocol": "tcp",
                        "ToPort": "8080"
                    }
                ],
                "VpcId": {
                    "Ref": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        }
    }
}
